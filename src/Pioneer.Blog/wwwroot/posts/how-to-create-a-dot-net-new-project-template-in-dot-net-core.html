<!doctype html>
<html class="no-js" lang="">
<head>
  <link href="/app.css" rel="stylesheet" />
  <script src="/app.js"></script>
</head>
<body>
  <div class="row">
    <div class="large-10 large-push-1 columns">
      <article>
        <p>March 7th, 2017 is just around the corner and with it comes the general availability of <a href="https://www.visualstudio.com/" title="Visual Studio 2017" target="_blank">Visual Studio 2017</a>.  Those who have been exploring the RC builds might have noticed a slew of updates coming to the <b>dotnet new</b> command in the dotnet command line tooling. One such feature now allows us to create project templates that can be installed from <a href="https://www.nuget.org/profiles/chad_ramos" title="NuGet" target="_blank">NuGet</a>, local folder or zip file.</p>
        <p>I will use the <a href="https://github.com/PioneerCode/pioneer-console-boilerplate" title="Pioneer Console Boilerplate" target="_blank">Pioneer Console Boilerplate</a> project I created to demonstrate the concepts of <a href="" title="Dependency Injection, Logging and Configuration In A .NET Core Console Application" target="_blankd">"Dependency Injection, Logging and Configuration In A .NET Core Console Application</a>" to show the following.</p>
        <ol>
          <li>Migrating <b>project.json</b> to the new <b>.csproj</b> build config required in VS 2017.</li>
          <li>Create necessary config to allow your project to serve as a template.</li>
          <li>Installing your template.</li>
          <li>Removing your template.</li>
        </ol>
        <h2>Migrating project.json</h2>
        <p>In effort to simplify compatibility with MSBuild, <b>project.json</b> is being retired in favor of <b>.csproj</b>. The process, in most cases, is dirt simple.  You have one of two options, run <b>dotnet migrate</b> or automation provided by Visual Studio 2017.  For this project, I choose to have Visual Studio guide me through the process.</p>
        <p>When I opened up <a href="https://github.com/PioneerCode/pioneer-console-boilerplate" title="Pioneer Console Boilerplate" target="_blank">Pioneer Console Boilerplate</a> in VS 17, I was prompted with the following. </p>
        <a href="/images/how-to-create-a-dot-net-new-project-template-in-dot-net-core/migration-prompt.png" title="Migration Prompt" target="_blank">
          <img src="/images/how-to-create-a-dot-net-new-project-template-in-dot-net-core/migration-prompt.png" alt="Migration Prompt" style="max-width: 686px;" />
        </a>
        <p>After confirming by clicking <b>OK</b>, I was supplied with the following report.</p>
        <a href="/images/how-to-create-a-dot-net-new-project-template-in-dot-net-core/migration-report.png" title="Migration Report" target="_blank">
          <img src="/images/how-to-create-a-dot-net-new-project-template-in-dot-net-core/migration-report.png" alt="Migration Report" style="max-width: 1202px;" />
        </a>
        <p>Everything is pretty self explanatory.  A backup was made of all files being touch prior to migration, followed by the actual migration taking place.  Below is a view of the original <b>project.json</b> and the new <b>Pioneer.Console.Boilerplate.csproj</b> files side by side for comparison.</p>
        <a href="/images/how-to-create-a-dot-net-new-project-template-in-dot-net-core/side-by-side.png" title="Side by side comparison." target="_blank">
          <img src="/images/how-to-create-a-dot-net-new-project-template-in-dot-net-core/side-by-side.png" alt="Side by side comparison." style="max-width: 1783px;" />
        </a>
        <h2>Adding Template Configuration</h2>
        <p>At the time a wrote this blog, details on the dotnet new templating system are understandable lacking.  After all, I am doing this in an RC of VS 17.  The information I was able to gather came from one of three sources.</p>
        <ol>
          <li>The official <a href="https://github.com/dotnet/templating/wiki/%22Runnable-Project%22-Templates" title="Dot Net Core templating documentation" target="_blank">documentation</a>.</li>
          <li>
            A project that has the templating system already figure out.
            <ul>
              <li>In it I reference a build script used to generate necessary files.</li>
              <li><a href="https://github.com/aspnet/JavaScriptServices/blob/dev/templates/package-builder/src/build/build.ts" target="_blank" title="JavascriptServices GitHub">JavascriptServices</a> by <a href="http://blog.stevensanderson.com/" target="_blank" title="Steve Standerson">Steve Standerson</a>.</li>
              <li>Going straight to the source and asking <a href="https://twitter.com/sayedihashimi" title="Sayed I. Hashimi" target="_blank">Sayed I. Hashimi</a> and <a href="https://twitter.com/shanselman" title="Scott Hanselman" target="_blank">Scott Hanselman</a> on twitter.</li>
            </ul>
          </li>
        </ol>
        <p>Lets start by creating a folder called <b>.template.config</b> in the project you want make a template. Inside that folder, add a file called <b>template.json</b>.</p>
        <a href="/images/how-to-create-a-dot-net-new-project-template-in-dot-net-core/template-config-view.png" title="Template Solution View" target="_blank">
          <img src="/images/how-to-create-a-dot-net-new-project-template-in-dot-net-core/template-config-view.png" alt="Template Solution View" style="max-width: 348px;" />
        </a>
        <p>There is a pretty long list of configuration option that can go into your <b>template.json</b> file.  For more information, I recommend going to official <a href="https://github.com/dotnet/templating/wiki/%22Runnable-Project%22-Templates" title="Dot Net Core templating documentation" target="_blank">documentation</a>.  Below is what I have added to my configuration.</p>
        <pre class="brush: json">{
  "author": "Chad Ramos &lt;chad@pioneercode.com&gt;",
  "classifications": [ "Console", "Boilerplate", "Dependecy Injection", "Logging", "Configuration" ],
  "name": "Pioneer Code: Console Application with dependecy injection, logging & configuration.",
  "tags": {
    "language": "C#"
  },
  "identity": "Pioneer.Console.Boilerplate",
  "shortName": "consoleboilerplate",
  "sourceName": "Pioneer.Console.Boilerplate"
}</pre>
        <p>Surprising enough, this short list of configuration will allow you to <b>dotnet new</b> your project from a local folder.</p>
        <h2>Installing Your Template From a Local Folder</h2>
        <p>To install your project as a template from your local folder, run the following - <b>dotnet new --install C:\source\Repos\pioneer-console-boilerplate\Pioneer.Console.Boilerplate</b>. You will need to adjust the path to your project as needed. </p>
        <p>Once installed, you should see your template in the available list. Run <b>dotnet new -l</b> to list all templates available.</p>
        <a href="/images/how-to-create-a-dot-net-new-project-template-in-dot-net-core/new-list.png" title="Dot Net new list." target="_blank">
          <img src="/images/how-to-create-a-dot-net-new-project-template-in-dot-net-core/new-list.png" alt="Dot Net new list." style="max-width: 1551px;" />
        </a>
        <p>To use your new template to generate project, run the following command with appropriate updates <b>dotnet new consoleboilerplate -n my.console</b>.  You should now see your new project at the directory specified.</p>
        <a href="/images/how-to-create-a-dot-net-new-project-template-in-dot-net-core/new-project.png" title="New Project." target="_blank">
          <img src="/images/how-to-create-a-dot-net-new-project-template-in-dot-net-core/new-project.png" alt="New Project." style="max-width: 759px;" />
        </a>
        <h3>Where Does Your New Template Cache Live & How Do I Remove My Template From That Cache?</h3>
        <p>By running the <b>dotnet new -i [source]</b> command, you are telling the cli to cache a reference to your package configuration. The <b>dotnetcli</b> needs to store this information in order to display your templates information when running <b>dotnet new</b>.  So why do we need to know where this information is cached?  Being I am writing this tutorial on some very early bits, I currently have not found a way to run a command to remove a template from your local cached list.  That being the case, I started searching around my local directories to find the file(s) holding this information in order to manually delete it.</p>
        <p class="note">I fully expect a command line switch to become available (if it is not already) that allows us to remove packages from our template cache.  Until then, the following method has worked for me.</p>
        <p>Navigate to <b>C:\Users\vagrant\.templateengine\dotnetcli\v1.0.0-rc4-004771</b>.  You will obviously have to update the user and version to suite your needs.  In this folder there are few files, <b>templatecache.json</b>, <b>settings.json</b> & <b>en-us.templatecache.json</b>.  Each of held a reference to my local template.</p>
        <a href="/images/how-to-create-a-dot-net-new-project-template-in-dot-net-core/template-cache.png" title="Template cache" target="_blank">
          <img src="/images/how-to-create-a-dot-net-new-project-template-in-dot-net-core/template-cache.png" alt="Template cache" style="max-width: 960px;" />
        </a>
        <p>After deleting the reference(s) from these files, <b>dotnet new -l</b> no longer has a reference to my template.</p>
        <a href="/images/how-to-create-a-dot-net-new-project-template-in-dot-net-core/empty-list.png" title="Empty List" target="_blank">
          <img src="/images/how-to-create-a-dot-net-new-project-template-in-dot-net-core/empty-list.png" alt="Empty List" style="max-width: 735px;" />
        </a>
        <h2>Creating A NuGet Package To Serve Our Template.</h2>
        <p>What if we want to serve up our template through a NuGet package? Lucky for us, the process is pretty straight forward. The contract that NuGet expects is for your nuspec file to live by a folder called content.  With that in mind, I had to make decided to nest my project code on elevel deeper to facilitate this.</p>
      </article>
    </div>
  </div>
</body>
</html>